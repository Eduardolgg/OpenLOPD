<!-- Copyright (C) 2012 [Gobierno de Espana]
     This file is part of "Cliente @Firma".
     "Cliente @Firma" is free software; you can redistribute it and/or modify it under the terms of:
      - the GNU General Public License as published by the Free Software Foundation;
        either version 2 of the License, or (at your option) any later version.
      - or The European Software License; either version 1.1 or (at your option) any later version.
     Date: 11/01/11
     You may contact the copyright holder at: soporte.afirma5@seap.minhap.es
-->

<!-- ================== ERRORES CONOCIDOS ========================================================================================

	-	Cambios internos de las nuevas versiones de la JRE (Java 6u32 y superiores y Java 7u4 y superiores) requieren
		de el entorno de ejecución de Visual C++ 2010 para acceder al almacén de certificados de Mozilla Firefox. Si no puede
		acceder al almacén, pruebe a instalarse este entorno de ejecución. Puede descargarlo desde:
		
			http://www.microsoft.com/download/en/details.aspx?id=5555
     ============================================================================================================================= -->	 
	 
 <!-- Ejemplo basico de lanzador de la aplicacion -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="es">
	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
		<script type="text/javascript" src="common-js/deployJava.js"></script>
		<script type="text/javascript" src="common-js/firma.js"></script>
		<script type="text/javascript" src="common-js/instalador.js"></script>
		<script type="text/javascript" src="constantes.js"></script>
		<script type="text/javascript" language="javascript"><!--

        	/*function operacionChanged(op)
        	{
				if(op == "firmar" || op == "cofirmar" || op == "contrafirmar"){
					document.getElementById('operacion').value = op;
				}
				
        		if(op == "firmar"){
        			document.getElementById("ficheroDatos").disabled = '';
        			document.getElementById("ficheroFirma").disabled = 'disabled';
				document.getElementById("ficheroFirma").value = '';
        			document.getElementById("botonCargar").disabled = 'disabled';
				var signersList = document.getElementById("firmantes");
				signersList.length = 0;
        		}
        		else if(op == "cofirmar"){
				document.getElementById("ficheroDatos").disabled = '';
        			document.getElementById("ficheroFirma").disabled = '';
        			document.getElementById("botonCargar").disabled = 'disabled';
				var signersList = document.getElementById("firmantes");
				signersList.length = 0;
        		}
        		else if(op == "contrafirmar"){
        			document.getElementById("ficheroDatos").disabled = 'disabled';
				document.getElementById("ficheroDatos").value = '';
        			document.getElementById("ficheroFirma").disabled = '';
        			document.getElementById("botonCargar").disabled = '';
        		}
        	}*/

        	function cambioTipoContrafirma(tipo)
        	{
        		document.getElementById('modoContrafirma').value = tipo;
        	}

        	function configurarOperacion()
        	{
				configuraFirma();

				// Configuramos la configuracion de firma por defecto
				clienteFirma.setSignatureAlgorithm("SHA1withRSA");
				clienteFirma.setSignatureFormat("XMLDSig Enveloped");
				clienteFirma.setSignatureMode("implicit");
				//clienteFirma.setShowExpiratedCertificates(false);

				// Configuramos los ficheros de firma
				fdatos = "http://localhost:8080/websigner/XMLDocument.xml";
				if(fdatos != null && fdatos != undefined && trim(fdatos) != "") {
					clienteFirma.setFileuri(fdatos);
				}
				ffirma = "";
				if(ffirma != null && ffirma != undefined && trim(ffirma) != "") {
					clienteFirma.setElectronicSignatureFile(ffirma);
				}
			}

        	function realizarOperacion()
        	{
				// Limpiamos la configuracion del cliente
				initialize();

				// Configuramos los datos de la operacion
				configurarOperacion();

				// Ejecutamos la operacion de firma
				clienteFirma.sign();				
				
				// Guardamos la firma en disco si todo ha salido bien
				if(!clienteFirma.isError()) {
					//clienteFirma.saveSignToFile();
                                        alert(clienteFirma.getSignatureBase64Encoded());
				}

				/* Solo mostramos el error via JavaScript si se ha configurado que no lo muestre el propio cliente */
				else if (!showErrors) {
					alert(clienteFirma.getErrorMessage());
				}
			}

			function trim(cad)
			{
				return cad.replace(/^(\s|\t|\r|\n)*|(\s|\t|\r|\n)*$/g,"");
			}

		--></script>
	<title>Ejemplo de multifirma</title>
	</head>
	<body>
		<script type="text/javascript">
			cargarAppletFirma('COMPLETA');
		</script>
		<form name="prueba" id="prueba" action="">
			<input type="hidden" value="firmar" id="operacion">
			<input type="hidden" value="NODOS" id="modoContrafirma">
			<table align="center">
			<tr>
				<td>
					<!--<fieldset><legend>Formato de firma por defecto</legend>
					<table>
						<tr>
							<td><label for="algoritmo">Algoritmo</label></td>
							<td><label for="formato">Formato</label></td>
							<td><label for="modoFirma">Modo</label></td>
						</tr>
						<tr>
							<td>
								<select id="algoritmo">
									<option value="SHA1withRSA" selected="selected">SHA1 con RSA</option>
									<option value="SHA1withRSA">SHA512 con RSA</option>
									<option value="MD5withRSA">MD5 con RSA</option>
									<option value="MD2withRSA">MD2 con RSA</option>
								</select>
							</td>
							<td>
								<select id="formato">
									<option value="CMS/PKCS#7" selected="selected">CMS/PKCS#7</option>
									<option value="CAdES">CAdES</option>
									<option value="XAdES Detached">XAdES/XAdES Detached</option>
									<option value="XAdES Enveloped">XAdES Enveloped</option>
									<option value="XAdES Enveloping" >XAdES Enveloping</option>

									<option value="XMLDSig Detached">XMLDSig Detached</option>
									<option value="XMLDSig Enveloped">XMLDSig Enveloped</option>
									<option value="XMLDSig Enveloping">XMLDSig Enveloping</option>

									<option value="FacturaE">FacturaE (Factura electrónica)</option>
									<option value="PDF">Adobe PDF</option>
									<option value="ODF">ODF (Open Document Format)</option>
									<option value="OOXML">OOXML (Office Open XML)</option>
								</select>
							</td>
							<td>
								<select id="modoFirma">
									<option value="explicit" selected="selected">Explícita</option>
									<option value="implicit">Implícita</option>
								</select>
							</td>
						</tr>
					</table>
					</fieldset>-->
				</td>
			</tr>
			
			<tr>
				<td>
					<!--<fieldset><legend>Tipo de operación</legend>
					<table>
						<tr>
							<td>
								<input type="radio" name="operacion" id="rbFirmar" value="firmar"
								onchange="operacionChanged('firmar')" onclick="operacionChanged('firmar')" checked="checked" >
								<label for="rbFirmar">Firmar</label>
							</td>
						</tr>
						<tr>
							<td>
								<input type="radio" name="operacion" id="rbCofirmar" value="cofirmar"
								onchange="operacionChanged('cofirmar')" onclick="operacionChanged('cofirmar')" >
								<label for="rbCofirmar">Co-firmar</label>
							</td>
						</tr>
						<tr>
							<td>
								<input type="radio" name="operacion" id="rbContrafirmar" value="contrafirmar"
								onchange="operacionChanged('contrafirmar')" onclick="operacionChanged('contrafirmar')" >
								<label for="rbContrafirmar">Contra-firmar</label>
							</td>
						</tr>
					</table>
					</fieldset>-->
				</td>
			</tr>
			<tr>
				<td colspan="3"><!--
					<fieldset id="entradaDatos"><legend>Fichero a firmar</legend>
					<table style="width: 100%">
						<tr>
							<td>
								<label for="ficheroDatos"><span>Fichero de datos:</span></label><br >
								<input type="text" id="ficheroDatos" style="width: 100%">
							</td>
						</tr>
						<tr>
							<td>
								<label for="ficheroFirma"><span>Fichero de firma:</span></label><br >
								<input type="text" id="ficheroFirma" disabled="disabled" style="width: 100%">
							</td>
						</tr>
					</table>
					</fieldset>-->
				</td>
			</tr>			
			<tr>
				<td colspan="2">
					<!--<fieldset><legend>Firmantes</legend>
					<table style="width: 100%">
						<tr>
							<td>
								<label for="tipoContrafirma"><span>Tipo de contrafirma:</span></label><br >
								<select name="tipoContrafirma" id="tipoContrafirma" onchange="cambioTipoContrafirma(this.value)">
									<option value="NODOS">Nodos seleccionados</option>
									<option value="FIRMANTES">Firmantes seleccionados</option>
									<option value="ARBOL">Árbol entero</option>
									<option value="HOJAS">Hojas del árbol</option>
								</select>
							</td>
							<td rowspan="2" style="width: 100%">
								<div id="firmantesTD" style="width: 100%">
									<label for="firmantes"><span>Nodos de firma:</span></label><br >
									<select multiple="multiple" name="firmantes" id="firmantes" size="5" style="width: 100%">
									<option value=""></option>
									</select>
								</div>
							</td>
						</tr>
						<tr>
							<td align="center">
								<input type="button" id="botonCargar" title="CargarFirma" onclick="cargarFirma();return false;" value="Cargar firma" disabled="disabled" >
							</td>
						</tr>
					</table>
					</fieldset>-->
				</td>
			</tr>
			<tr>
				<td align="center" colspan="2">
					<input name="btnFirma" type="button" title="Firmar" value="Firmar" onclick="realizarOperacion(); return false;">
				</td>
			</tr>
		</table>
		</form>
	</body>
</html>	